(()=>{"use strict";const e=new class{constructor(){this.newUser=document.querySelector(".name"),this.next=document.querySelector(".next"),this.startChat=document.querySelector(".login"),this.loginLabel=document.querySelector(".header"),this.chat=document.querySelector(".chat"),this.send=document.querySelector(".send"),this.chatInput=document.querySelector(".new-message"),this.userList=document.querySelector(".user-list"),this.msgField=document.querySelector(".messages-field")}changeName(){this.loginLabel.style.color="red",this.newUser.classList.add("invalid"),this.loginLabel.innerHTML="Select another name"}drawUsersList(e){this.userList.innerHTML+=`\n    <li class="user-items">${e}</li>\n    `}drawMsgList(e,s,t,i){let n="",r=e;t===e&&(n="you",r="You"),this.msgField.innerHTML+=`<div class="message-container ${n}">\n      <div class="message">\n          <div class="header-message">\n              <h6 class="user">${r}</h6>\n              <span class="date">${i}</span>\n          </div>\n          ${s}\n      </div>\n    </div>`}},s=new class{constructor(e){this.gui=e,this.url="wss://ahj-ws-server-pfokin.herokuapp.com",this.enterUser=this.enterUser.bind(this),this.user=null}init(){this.wsConnect(),this.gui.next.addEventListener("click",(e=>this.enterUser(e))),this.gui.send.addEventListener("click",(e=>this.sendMessage(e)))}enterUser(e){e.preventDefault();const s=document.querySelector(".name").value;this.user=s,this.ws.send(JSON.stringify({login:s})),this.getMessages()}sendMessage(e){e.preventDefault(),this.ws.send(JSON.stringify({message:this.gui.chatInput.value})),this.gui.chatInput.value=""}getMessages(){this.ws.send(JSON.stringify({messagesList:!0}))}wsConnect(){this.ws=new WebSocket(this.url);const{ws:e}=this;e.binaryType="blob",e.addEventListener("open",(()=>{console.log("connected people")})),e.addEventListener("close",(()=>{console.log("close")})),e.addEventListener("message",(e=>{const s=JSON.parse(e.data);console.log(s),s?s[0].msg?s[0].msg&&(this.gui.msgField.innerHTML="",s.forEach((e=>{this.gui.drawMsgList(e.nickname,e.msg,this.user,e.date.toString().slice(11,16))}))):(this.gui.userList.innerHTML="",this.gui.chat.classList.remove("hidden"),this.gui.startChat.classList.add("hidden"),s.forEach((e=>{this.gui.drawUsersList(e.name)}))):this.gui.changeName()}))}}(e);s.init()})();